<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parramatta Arabic School Teacher Enrollment Form</title>
<style>
    .pas-form * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'Arial', sans-serif;
        line-height: 1.6;
    }

    .pas-form {
        background: #fcfcfc;
        color: #333;
        padding: 0.5em;
        max-width: 100%;
        overflow: auto;
    }

    .pas-form h1 {
        color: #981c1c;
        margin-bottom: 1em;
        font-size: 1.8em;
        border-bottom: 2px solid #eee;
        padding-bottom: 0.8em;
    }

    .pas-form legend {
        font-size: 1.2em;
        padding: 0 0.8em;
        font-weight: 700;
        color: #981c1c;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .pas-form input,
    .pas-form select,
    .pas-form textarea {
        font-size: 0.95em;
        padding: 0.8em;
        border: 1px solid #ccc;
        border-radius: 10px;
        transition: all 0.3s ease;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }

    .pas-form input:focus,
    .pas-form select:focus,
    .pas-form textarea:focus {
        outline: none;
        border-color: #981c1c;
        box-shadow: 0 0 0 3px rgba(152, 28, 28,0.1);
    }

    .pas-form textarea {
        resize: vertical;
        min-height: 100px;
    }

    .pas-form .form-row {
        display: flex;
        flex-direction: column;
        gap: 0.5em;
        margin-bottom: 1.2em;
    }

    .pas-form .form-row > .checkbox-group,
    .pas-form .form-row > .radio-group,
    .pas-form .form-row > .instruction-text,
    .pas-form .form-row > textarea {
        grid-column: 1 / -1;
        width: 100%;
    }

    .pas-form .form-row > :not(label):not(:first-child):last-child:not(input):not(select) {
        grid-column: 1 / -1;
    }

    .pas-form fieldset {
        margin: 1.5em 0;
        padding: 1.5em;
        border: 1px solid #ddd;
        border-radius: 6px;
        background: #f8f9fa;
    }

    .pas-form .inline-group {
        display: flex;
        gap: 1em;
        margin: 1em 0;
        flex-wrap: wrap;
    }

    .pas-form .inline-group .form-row {
        flex: 1 1 100%;
        min-width: 150px;
    }

    @media (max-width: 600px) {
        .pas-form .inline-group {
            flex-direction: column;
            gap: 0.5em;
        }

        .pas-form .inline-group .form-row {
            flex: 1 1 100%;
        }
    }

    .pas-form button {
        background: #981c1c;
        color: #fff;
        padding: 1em 2em;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1em;
        margin: 1.5em 0;
        transition: all 0.3s ease;
    }

    .pas-form button:hover {
        background: #003366;
        transform: translateY(-1px);
    }

    .pas-form input[type="radio"],
    .pas-form input[type="checkbox"] {
        width: auto;
        height: 1.1em;
        margin-right: 0.5em;
    }

    .pas-form .checkbox-group label,
    .pas-form .radio-group label {
        display: flex;
        align-items: center;
        margin: 0.5em 0;
    }

    .pas-form {
        min-height: 100vh;
        box-sizing: border-box;
    }

    .pas-form .instruction-text {
        font-size: 0.9em;
        margin: 1em 0;
        padding: 1em;
        border: 1px solid #eee;
        border-radius: 4px;
        background: #f8f9fa;
        color: #555;
    }

    .pas-form .required {
        font-weight: 600;
    }

    .pas-form .required::after {
        content: "*";
        color: #e00;
        margin-left: 4px;
        display: inline-block;
    }

    .pas-form select {
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 0.8em center;
        background-size: 1em;
    }

    .pas-form h3 {
        margin: 1.5em 0 1em;
        color: #444;
        font-size: 1.1em;
        padding-top: 0.5em;
        border-top: 1px solid #eee;
    }

    .error-highlight {
        border-color: #ff0000 !important;
        box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1) !important;
    }

    .ques-description {
        color: #666;
    }

    .error-message {
        color: #ff0000;
        font-size: 0.9em;
        margin-top: 0.5em;
        padding: 0.5em;
        background-color: #fff0f0;
        border: 1px solid #ffcccc;
        border-radius: 4px;
        display: inline-block;
        width: 100%;
        box-sizing: border-box;
    }

    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 1000;
    }

    .loading-spinner {
        width: 80px;
        height: 80px;
        animation: spin 1s linear infinite;
    }

    .loading-text {
        margin-top: 1em;
        color: #981c1c;
        font-weight: bold;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .pas-form datalist {
        position: absolute;
        background: white;
        border: 1px solid #ccc;
        border-radius: 0 0 4px 4px;
        width: 100%;
    }

    .pas-form label {
        font-weight: bold;
    }
        .enrollment-guidelines {
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 1.5em;
        margin-bottom: 2em;
        line-height: 1.6;
    }
    
    .enrollment-guidelines h2 {
        color: #981c1c;
        margin-bottom: 0.5em;
        font-size: 1.5em;
        border-bottom: 1px solid #eee;
        padding-bottom: 0.5em;
    }
    
    .enrollment-guidelines p {
        margin-bottom: 1em;
    }

    .faq-accordion {
        margin-bottom: 2em;
        border: 1px solid #ddd;
        border-radius: 4px;
        overflow: hidden;
        background-color: transparent;
    }

    .faq-accordion h2 {
        color: #333;
        margin-bottom: 0;
        font-size: 1.2em;
        padding: 0.5em 1.2em;
        border-bottom: 1px solid #ddd;
        background-color: transparent;
    }

    .accordion-item {
        border-bottom: 1px solid #ddd;
    }

    .accordion-item:last-child {
        border-bottom: none;
    }

    .accordion-button {
        background-color: #f8f9fa !important;
        color: #333 !important;
        cursor: pointer !important;
        padding: 0.5em 1.3em !important;
        width: 100% !important;
        text-align: left !important;
        border: 0.8 !important;
        border-color: #f8f9fa !important;
        border-bottom: 0.8px solid #f8f9fa !important;
        outline: none !important;
        transition: 0.2s !important;
        font-weight: bold !important;
        font-size: 0.9em !important;
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        margin: 0 !important;
    }

    .accordion-button:hover {
        background-color: #fafafa;
    }

    .accordion-button.active {
        background-color: #fff;
        border-bottom: none;
    }

    .accordion-button:after {
        content: '+';
        font-size: 1em;
        color: #555;
        margin-left: 5px;
    }

    .accordion-content {
        padding: 0;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
        background-color: transparent;
        border-top: none;
    }

    .accordion-content-inner {
        padding: 0.8em 1.2em;
        color: #555;
        font-size: 0.9em;
        border-top: 1px solid #eee;
    }

    .accordion-content p {
        margin-bottom: 0.8em;
    }

    .accordion-content p:last-child {
        margin-bottom: 0;
    }
</style>
</head>
<body>
    <div class="pas-form">
        <div class="enrollment-guidelines">
            <h2>Enrollment Guidelines</h2>
            <p>To enrol your child at Parramatta Arabic School, please complete our expression of interest form and bring your child for assessment. The information you provide will be used to finalise your child's enrolment.</p>
            <p>We organise an assessment day at the start of Term 1 each year and will notify you via email if your application is received in time for this day. If you submit your application after the start of Term 1, you can bring your child for an assessment on any Saturday during school terms between 9:30 am and 12:30 pm.</p>
            <p>We will try our best to accommodate your child in one of our classes. However, due to the high demand for our beginner classes and the limited spaces available, we cannot guarantee placement. Intermediate and advanced classes are generally available throughout the year.</p>
            <p>For the latest updates on our school activities, follow our <a style="color: #981c1c;" href="https://www.facebook.com/parramattaarabic" target="_blank">Facebook page</a> and join our <a style="color: #981c1c;" href="https://chat.whatsapp.com/LsXTM517PUH71cndoR6Bqy" target="_blank">WhatsApp group</a>.</p>
        </div>

        <div class="faq-accordion">
            <h2 style="color: #981c1c;">Frequently Asked Questions</h2>
            
            <div class="accordion-item">
                <button class="accordion-button">What is the length of the program and attendance requirements?</button>
                <div class="accordion-content">
                    <div class="accordion-content-inner">
                        <p>Our programs are designed to be delivered over a full year, and commitment to the yearly schedule is essential for children to gain the maximum benefit. If you're seeking short-term courses, our program may not align with your needs.</p>
                        <p>Since our classes are only held once a week, it is important that students attend all sessions to maximise their learning potential. Education is a sequential process, and missing even one class can result in students missing important stages in the progression of topics, making it harder for them to keep up.</p>
                        <p>Our programs are coordinated with the NSW Department of Education, and students who attend at least 70% of classes will be eligible for a Certificate of Attendance issued by the Department. The certificate is only available to students who participate from the start of the year.</p>
                    </div>
                </div>
            </div>
            
            <div class="accordion-item">
                <button class="accordion-button">How much do I need to pay?</button>
                <div class="accordion-content">
                    <div class="accordion-content-inner">
                        <p>The annual fee for our program is $800 ($200 per term), billed semi-annually at $400 per semester inclusive of books and GST. A sibling discount is available: 5% off the total fee for two enrolled students, and 10% for three or more children. We accept Creative Kids vouchers issued by Service NSW.</p>
                        <p>As a non-profit organisation, the school uses the tuition fees to pay for rent, books, learning materials, gifts and awards, teachers' salaries, and general administration. Upon acceptance and fee payment, a seat will be reserved for your child, and the fee becomes non-refundable. Please ensure your child can commit to the full program before applying, to avoid any misunderstandings.</p>
                    </div>
                </div>
            </div>
            
            <div class="accordion-item">
                <button class="accordion-button">Do you provide tahfiz (Quran memorisation) programs?</button>
                <div class="accordion-content">
                    <div class="accordion-content-inner">
                        <p>No, we don't offer tahfiz programs. At Parramatta Arabic School, our programs focus on teaching the Arabic language, which aids in improving students' abilities to read and memorise on their own.</p>
                        <p>We offer a light Quranic program alongside our Arabic program, giving a great opportunity for those interested in practising Quran memorisation and learning correct recitation.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <form id="enrollmentForm">
            <fieldset>
                <legend>Teacher Details</legend>
                <div class="instruction-text">
                    <p>Please complete the form carefully, select the program you wish to apply for and provide your child's details as provided to their mainstream school.</p>
                </div>

                <div class="form-row">
                    <label class="required">Teacher First Name</label>
                    <input type="text" name="teacherFirstName" required>
                </div>

                <div class="form-row">
                    <label class="required">Teacher Last Name</label>
                    <input type="text" name="teacherLastName" required>
                </div>

                <div class="form-row">
                    <label class="required">Teacher Birth Date</label>
                    <input type="date" name="teacherBirthDate" placeholder="DD/MM/YYYY" required>
                </div>

                <div class="form-row">
                    <label class="required">Gender</label>
                    <div class="checkbox-group">
                        <label><input type="radio" name="gender" value="Male" required> Male</label>
                        <label><input type="radio" name="gender" value="Female" required> Female</label>
                    </div>
                </div>

                <div class="form-row">
                    <label class="required">Mother Tongue</label>
                    <div class="checkbox-group">
                        <label><input type="radio" name="motherTongue" value="Arabic" required> Arabic</label>
                        <label><input type="radio" name="motherTongue" value="English" required> English</label>
                        <label><input type="radio" name="motherTongue" value="Other" required> Other</label>
                    </div>
                </div>
            </fieldset>

            <fieldset>
                <legend>Education</legend>
                <div class="form-row">
                    <label class="required">Educational Level</label>
                    <select name="educationalLevel" required>
                        <option value="">Select Educational Level</option>
                        <option>Bachelor's Degree</option>
                        <option>Diploma</option>
                        <option>Doctorate Degree</option>
                        <option>Graduate Certificate</option>
                        <option>High School Certificate</option>
                        <option>Master's Degree</option>
                        <option>Non-Degree Program</option>
                        <option>Technical Qualification</option>
                    </select>
                </div>

                <div class="form-row">
                    <label class="required">Educational Institution Name</label>
                    <input type="text" name="institutionName" required>
                </div>

                <div class="form-row">
                    <label class="required">Name of Qualification</label>
                    <input type="text" name="qualificationName" required>
                </div>

                <div class="form-row">
                    <label class="required">Date of Completion</label>
                    <input type="date" name="completionDate" required>
                </div>

                <div class="form-row">
                    <label>Other Education Description</label>
                    <textarea name="otherEducationDescription"></textarea>
                </div>
            </fieldset>

            <fieldset>
                <legend>Application Details</legend>
                <div class="form-row">
                    <label class="required">What are you interested to apply for?</label>
                    <div class="checkbox-group">
                        <label><input type="radio" name="applicationType" value="Paid Part Time / Casual Work" required> Paid Part Time / Casual Work</label>
                        <label><input type="radio" name="applicationType" value="Volunteer only" required> Volunteer only</label>
                    </div>
                </div>

                <div class="form-row">
                    <label class="required">What are you interested to teach?</label>
                    <select name="teachingInterest" required>
                        <option value="">Select Teaching Interest</option>
                        <option>Arabic for beginners</option>
                        <option>Arabic for intermediate students</option>
                        <option>Arabic for advanced students</option>
                        <option>Quran recitation</option>
                    </select>
                </div>

                <fieldset>
                    <legend>Working with Children Clearance</legend>
                    <div class="form-row">
                        <label class="required">Do you have an active NSW Government issued WWCC?</label>
                        <div class="checkbox-group">
                            <label><input type="radio" name="hasWWCC" value="Yes" required> Yes</label>
                            <label><input type="radio" name="hasWWCC" value="No" required> No</label>
                        </div>
                    </div>

                    <div id="wwccDetails" style="display: none;">
                        <div class="form-row">
                            <label class="required">WWCC Number</label>
                            <input type="text" name="wwccNumber" required>
                        </div>

                        <div class="form-row">
                            <label class="required">What is the status of your Working with Children Check?</label>
                            <select name="wwccStatus" required>
                                <option value="">Select Status</option>
                                <option>Volunteer</option>
                                <option>Paid</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <label class="required">Expiration Date</label>
                            <input type="date" name="wwccExpirationDate" required>
                        </div>
                    </div>
                </fieldset>
            </fieldset>

            <fieldset>
                <legend>Contact Details</legend>
                <div class="form-row">
                    <label class="required">Email Address</label>
                    <input type="email" name="contactEmail" required>
                </div>
                <div class="form-row">
                    <label class="required">Phone Number</label>
                    <input type="tel" name="contactPhone" required>
                </div>
                <h3>Address</h3>
                <div class="form-row">
                    <label>Unit/Apartment Number</label>
                    <div class="ques-description">If applicable, e.g. Unit 5, Apt 10B (optional)</div>
                    <input type="text" name="unitNumber">
                </div>
                <div class="form-row">
                    <label class="required">Street Address</label>
                    <div class="ques-description">Include street number and street name (e.g., 123 Main St)</div>
                    <input type="text" name="streetName" required>
                </div>
                <div class="inline-group">
                    <div class="form-row" style="flex:1">
                        <label class="required">Suburb</label>
                        <input type="text" name="suburb" required>
                    </div>
                    <div class="form-row" style="flex:1">
                        <label class="required">State</label>
                        <select name="state" required>
                            <option>NSW</option>
                            <option>VIC</option>
                            <option>QLD</option>
                            <option>SA</option>
                            <option>WA</option>
                            <option>TAS</option>
                            <option>NT</option>
                            <option>ACT</option>
                        </select>
                    </div>
                    <div class="form-row" style="flex:1">
                        <label class="required">Post Code</label>
                        <input type="number" name="postCode" required>
                    </div>
                </div>
            </fieldset>

            <!-- Program Details Section -->
            <fieldset>
                <legend>Program Details</legend>
                <div class="instruction-text">
                    <p>The school serves students of diverse backgrounds, apps, and interests, creating a welcoming environment where they can develop their Arabic language skills. Our program focuses on building skills in reading, writing, speaking, and listening through structured lessons and interactive activities.</p>
                    <p>This is supplemented by a Quran Program that helps students memorise selected venues and improve recitation, enhancing both literacy and language development. Families who prefer their children to participate in the Arabic program only or have specific preferences are encouraged to indicate these in their application and discuss them with us during the enrolment process.</p>
                </div>
            </fieldset>

            <!-- Consent & Declaration Section -->
            <fieldset>
                <legend>Consent and Declaration</legend>
                <div class="instruction-text">
                    <p>The personal information collected on this information form is for purposes directly related to your child's attendance at Parramatta Arabic School, including the processing of applications for the NSW Community Languages Schools Program, administered by the NSW Department of Education.</p>
                    <p>Any information provided to the Department of Education will be used, disclosed and stored consistent with the NSW privacy laws. Certain information is required by the Department of Education to meet its obligations in relation to data collection, reporting and the payment of grants.</p>
                </div>
                <div class="instruction-text">
                    <p>I consent to providing information contained on this form to the Department of Education and to confirm the accuracy of the information with other organisations that may also hold information related to the student named.</p>
                    <p>I have read the information concerning the collection of personal information. I declare that the information provided in this enrolment form is accurate and complete to the best of my knowledge.</p>
                </div>

                <div class="form-row">
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="informationAccuracy" required> I have accurately provided information related to the student in this form</label>
                        <label><input type="checkbox" name="dataSharing" required> I consent to information sharing as described above</label>
                    </div>
                </div>

                <div class="form-row" id="applicantNameContainer" style="display: none;">
                    <label class="required">Applicant's Full Name</label>
                    <div class="radio-group" id="applicantNameGroup">
                        <label><input type="radio" name="applicantName" value="" required checked> <span id="parent1NameOption"></span></label>
                        <label id="parent2NameLabel" style="display: none;"><input type="radio" name="applicantName" value=""> <span id="parent2NameOption"></span></label>
                    </div>
                </div>
            </fieldset>

            <div style="text-align: center">
                <button type="submit">Submit Application</button>
            </div>
        </form>

        <div id="thankYouMessage" style="display: none; text-align: center; margin-top: 2em;">
            <h1>Thank You!</h1>
            <p>Your application has been submitted successfully.</p>
            <p>We will review your application and contact you soon.</p>
        </div>

        <div id="statusMessage" style="text-align: center; margin-top: 1em;"></div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <img src="https://arabicschool.blob.core.windows.net/arabicschool/statics/loading.svg" 
             alt="Loading..." 
             class="loading-spinner">
        <div class="loading-text">Submitting your application... Please wait</div>
    </div>

   <script>
        // Clear existing error messages and highlights
        function clearExistingErrors() {
            document.querySelectorAll('.error-message').forEach(el => el.remove());
            document.querySelectorAll('.error-highlight').forEach(el => el.classList.remove('error-highlight'));
        }

        // Fetch schools and populate datalist
        document.addEventListener('DOMContentLoaded', function() {
            fetch('https://arabicschool.azurewebsites.net/api/mainstream?code=nCeL7kzjSTmt7QGi1iROsTgStOt-jrDlJ9baxZ5wIOCCAzFu9cCanw==')
                .then(response => response.json())
                .then(schools => {
                    const datalist = document.getElementById('schools');
                    schools.forEach(school => {
                        const option = document.createElement('option');
                        option.value = school;
                        datalist.appendChild(option);
                    });
                    // Add "Other" option
                    const otherOption = document.createElement('option');
                    otherOption.value = 'Other';
                    datalist.appendChild(otherOption);
                })
                .catch(error => console.error('Error fetching schools:', error));
        });

        // Handle "Other" selection
        const schoolInput = document.querySelector('[name="mainstreamSchoolName"]');
        const otherSchoolContainer = document.getElementById('otherSchoolContainer');

        schoolInput.addEventListener('input', function() {
            if (this.value === 'Other') {
                otherSchoolContainer.style.display = 'block';
                document.querySelector('[name="otherSchoolName"]').required = true;
            } else {
                otherSchoolContainer.style.display = 'none';
                document.querySelector('[name="otherSchoolName"]').required = false;
            }
        });

        // Modified validation function
        function validateForm(formData) {
            const errors = [];
            const parent1Name = formData.get('parent1Name');
            const parent1Phone = formData.get('parent1Phone');
            const parent1Email = formData.get('parent1Email');
            const parent1ConfirmEmail = formData.get('parent1ConfirmEmail');
            const parent2Name = formData.get('parent2Name');
            const parent2Phone = formData.get('parent2Phone');
            const parent2Email = formData.get('parent2Email');
            const emergencyName = formData.get('emergencyContactName');
            const emergencyPhone = formData.get('emergencyContactPhone');
            const schoolValue = formData.get('mainstreamSchoolName');
            const otherSchoolValue = formData.get('otherSchoolName');
            const parent1Relationship = formData.get('parent1Relationship');
            const parent1OtherRelationship = formData.get('parent1OtherRelationship');
            const parent2Relationship = formData.get('parent2Relationship');
            const parent2OtherRelationship = formData.get('parent2OtherRelationship');
            const emergencyRelationship = formData.get('emergencyContactRelationship');
            const emergencyOtherRelationship = formData.get('emergencyOtherRelationship');

            // Check Emergency Contact vs Parent 1
            if (emergencyName === parent1Name) {
                errors.push({ field: 'emergencyContactName', message: 'Emergency Contact name cannot be the same as Parent/Carer 1.' });
            }

            // Check Emergency Contact vs Parent 2
            if (parent2Name && emergencyName === parent2Name) {
                errors.push({ field: 'emergencyContactName', message: 'Emergency Contact name cannot be the same as Parent/Carer 2.' });
            }

            if (emergencyPhone === parent1Phone) {
                errors.push({ field: 'emergencyContactPhone', message: 'Emergency Contact phone cannot be the same as Parent/Carer 1.' });
            }

            if (parent2Phone && emergencyPhone === parent2Phone) {
                errors.push({ field: 'emergencyContactPhone', message: 'Emergency Contact phone cannot be the same as Parent/Carer 2.' });
            }

            // Check Parent 2 vs Parent 1
            if (parent2Name && parent2Name === parent1Name) {
                errors.push({ field: 'parent2Name', message: 'Parent/Carer 2 name cannot match Parent/Carer 1.' });
            }

            if (parent2Phone && parent2Phone === parent1Phone) {
                errors.push({ field: 'parent2Phone', message: 'Parent/Carer 2 phone cannot match Parent/Carer 1.' });
            }

            if (parent2Email && parent2Email === parent1Email) {
                errors.push({ field: 'parent2Email', message: 'Parent/Carer 2 email cannot match Parent/Carer 1.' });
            }

            // Check Email Confirmation
            if (parent1Email !== parent1ConfirmEmail) {
                errors.push({ field: 'parent1ConfirmEmail', message: 'Email addresses do not match.' });
            }

            // Check "Other" School Name
            if (schoolValue === 'Other' && !otherSchoolValue) {
                errors.push({ field: 'otherSchoolName', message: 'Please specify the school name.' });
            }

            // Check "Other" Relationship
            if (parent1Relationship === 'Other' && !parent1OtherRelationship) {
                errors.push({ field: 'parent1OtherRelationship', message: 'Please specify the relationship.' });
            }

            if (parent2Relationship === 'Other' && !parent2OtherRelationship) {
                errors.push({ field: 'parent2OtherRelationship', message: 'Please specify the relationship.' });
            }

            if (emergencyRelationship === 'Other' && !emergencyOtherRelationship) {
                errors.push({ field: 'emergencyOtherRelationship', message: 'Please specify the relationship.' });
            }

            return errors;
        }

        // Modified submission handler to scroll to first error field
        document.getElementById('enrollmentForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const submitButton = event.target.querySelector('button[type="submit"]');
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            // Show loading overlay
            loadingOverlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            submitButton.disabled = true;
            clearExistingErrors();

            try {
                const formData = new FormData(event.target);
                const errors = validateForm(formData);

                if (errors.length > 0) {
                    // Handle validation errors
                    let firstErrorField = null;
                    
                    errors.forEach(error => {
                        const field = document.querySelector(`[name="${error.field}"]`);
                        if (field) {
                            // Keep track of first error field for scrolling
                            if (!firstErrorField) {
                                firstErrorField = field;
                            }
                            
                            // Add error highlight class
                            field.classList.add('error-highlight');
                            
                            // Create error message element
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'error-message';
                            errorDiv.textContent = error.message;
                            
                            // For email match error, highlight both fields
                            if (error.field === 'parent1ConfirmEmail' && error.message === 'Email addresses do not match.') {
                                const emailField = document.querySelector('[name="parent1Email"]');
                                if (emailField) {
                                    emailField.classList.add('error-highlight');
                                }
                            }
                            
                            // For phone number duplication errors, highlight both fields
                            if (error.field === 'emergencyContactPhone' && error.message.includes('same as Parent/Carer 1')) {
                                const parentPhone = document.querySelector('[name="parent1Phone"]');
                                if (parentPhone) {
                                    parentPhone.classList.add('error-highlight');
                                }
                            }
                            
                            if (error.field === 'emergencyContactPhone' && error.message.includes('same as Parent/Carer 2')) {
                                const parentPhone = document.querySelector('[name="parent2Phone"]');
                                if (parentPhone) {
                                    parentPhone.classList.add('error-highlight');
                                }
                            }
                            
                            if (error.field === 'parent2Phone' && error.message.includes('match Parent/Carer 1')) {
                                const parentPhone = document.querySelector('[name="parent1Phone"]');
                                if (parentPhone) {
                                    parentPhone.classList.add('error-highlight');
                                }
                            }
                            
                            // For name duplication errors, highlight both fields
                            if (error.field === 'emergencyContactName' && error.message.includes('same as Parent/Carer 1')) {
                                const parentName = document.querySelector('[name="parent1Name"]');
                                if (parentName) {
                                    parentName.classList.add('error-highlight');
                                }
                            }
                            
                            if (error.field === 'emergencyContactName' && error.message.includes('same as Parent/Carer 2')) {
                                const parentName = document.querySelector('[name="parent2Name"]');
                                if (parentName) {
                                    parentName.classList.add('error-highlight');
                                }
                            }
                            
                            if (error.field === 'parent2Name' && error.message.includes('match Parent/Carer 1')) {
                                const parentName = document.querySelector('[name="parent1Name"]');
                                if (parentName) {
                                    parentName.classList.add('error-highlight');
                                }
                            }
                            
                            // Insert error message after field
                            field.parentNode.insertBefore(errorDiv, field.nextSibling);
                        }
                    });
                    
                    // Scroll to the first error field to help user see the issue
                    if (firstErrorField) {
                        setTimeout(() => {
                            // Use a small timeout to ensure DOM updates are complete
                            firstErrorField.scrollIntoView({
                                behavior: 'smooth',
                                block: 'center'
                            });
                            firstErrorField.focus();
                        }, 100);
                    }
                    
                    document.getElementById('statusMessage').textContent = 'Please correct the highlighted errors.';
                    throw new Error('Validation errors');
                }

                // Get school value
                const schoolValue = formData.get('mainstreamSchoolName');
                const otherSchoolValue = formData.get('otherSchoolName');
                const mainstream = schoolValue === 'Other' ? otherSchoolValue : schoolValue;

                // Get relationship values
                const parent1Relationship = formData.get('parent1Relationship') === 'Other' ? formData.get('parent1OtherRelationship') : formData.get('parent1Relationship');
                const parent2Relationship = formData.get('parent2Relationship') === 'Other' ? formData.get('parent2OtherRelationship') : formData.get('parent2Relationship');
                const emergencyRelationship = formData.get('emergencyContactRelationship') === 'Other' ? formData.get('emergencyOtherRelationship') : formData.get('emergencyContactRelationship');

                // Combine address components into standard address format
                const unitNumber = formData.get('unitNumber');
                const streetName = formData.get('streetName');
                
                // Format: [Unit/Apt (if present)], [Street Address]
                let streetAddress = '';
                if (unitNumber) {
                    streetAddress = `${unitNumber}, ${streetName}`;
                } else {
                    streetAddress = streetName;
                }

                const data = {
                    student: {
                        firstName: formData.get('studentFirstName'),
                        lastName: formData.get('studentLastName'),
                        birthDate: formData.get('studentBirthDate'),
                        gender: formData.get('gender'),
                        school: schoolValue,
                        yearLevel: formData.get('yearLevel'),
                        email: formData.get('studentEmail')
                    },
                    parent1: {
                        name: formData.get('parent1Name'),
                        relationship: parent1Relationship,
                        phone: formData.get('parent1Phone'),
                        email: formData.get('parent1Email')
                    },
                    parent2: {
                        name: formData.get('parent2Name'),
                        relationship: parent2Relationship,
                        phone: formData.get('parent2Phone'),
                        email: formData.get('parent2Email')
                    },
                    address: {
                        street: streetAddress,
                        suburb: formData.get('suburb'),
                        state: formData.get('state'),
                        postCode: formData.get('postCode')
                    },
                    emergencyContact: {
                        name: formData.get('emergencyContactName'),
                        relationship: emergencyRelationship,
                        phone: formData.get('emergencyContactPhone')
                    },
                    programDetails: {
                        proficiency: formData.get('proficiencyLevel'),
                        interests: formData.getAll('interests'),
                        notes: formData.get('notes')
                    },
                    medicalInfo: formData.get('medicalInfo'),
                    photoConsent: formData.get('photoConsent'),
                    consent: {
                        informationAccuracy: formData.get('informationAccuracy') === 'on',
                        dataSharing: formData.get('dataSharing') === 'on'
                    },
                    applicantName: formData.get('applicantName'),
                    mainstream: mainstream
                };

                console.log(JSON.stringify(data));
                const response = await fetch('https://arabicschool.azurewebsites.net/api/student?code=jBJmpUad8UZ03f6ftJkX6l55TrxIFGjvp2khZuZw1Rq6AzFuM_nJ7g==', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) throw new Error('Network response was not ok');

                // Success handling
                document.getElementById('enrollmentForm').style.display = 'none';
                document.getElementById('thankYouMessage').style.display = 'block';
                document.getElementById('statusMessage').textContent = '';
            } catch (error) {
                // Hide loading overlay on error
                loadingOverlay.style.display = 'none';
                document.body.style.overflow = '';
                submitButton.disabled = false;
                
                if (error.message === 'Validation errors') {
                    document.getElementById('statusMessage').textContent = 'Please correct the highlighted errors.';
                    errors.forEach(error => {
                        const field = document.querySelector(`[name="${error.field}"]`);
                        if (field) {
                            field.classList.add('error-highlight');
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'error-message';
                            errorDiv.textContent = error.message;
                            field.parentNode.insertBefore(errorDiv, field.nextSibling);
                        }
                    });
                } else {
                    console.error('Error:', error);
                    document.getElementById('statusMessage').textContent = 
                        'Error submitting form. Please try again or contact support.';
                }
                return;
            } finally {
                loadingOverlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        });

        document.querySelectorAll('input[name="parent1Relationship"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const otherInput = document.querySelector('input[name="parent1OtherRelationship"]');
                otherInput.style.display = this.value === 'Other' ? 'block' : 'none';
                otherInput.required = this.value === 'Other';
            });
        });

        document.querySelectorAll('input[name="parent2Relationship"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const otherInput = document.querySelector('input[name="parent2OtherRelationship"]');
                otherInput.style.display = this.value === 'Other' ? 'block' : 'none';
                otherInput.required = this.value === 'Other';
            });
        });

        document.querySelectorAll('input[name="emergencyContactRelationship"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const otherInput = document.querySelector('input[name="emergencyOtherRelationship"]');
                otherInput.style.display = this.value === 'Other' ? 'block' : 'none';
                otherInput.required = this.value === 'Other';
            });
        });

        // Populate applicant name options
        document.querySelector('[name="parent1Name"]').addEventListener('input', function() {
            document.getElementById('parent1NameOption').textContent = this.value;
            document.querySelector('input[name="applicantName"][value=""]').value = this.value;
        });

        document.querySelector('[name="parent2Name"]').addEventListener('input', function() {
            const parent2NameLabel = document.getElementById('parent2NameLabel');
            const parent2NameOption = document.getElementById('parent2NameOption');
            if (this.value) {
                parent2NameLabel.style.display = 'block';
                parent2NameOption.textContent = this.value;
                parent2NameLabel.querySelector('input[name="applicantName"]').value = this.value;
            } else {
                parent2NameLabel.style.display = 'none';
                parent2NameOption.textContent = '';
                parent2NameLabel.querySelector('input[name="applicantName"]').value = '';
            }
        });

        function updateApplicantNameOptions() {
            const parent1Name = document.querySelector('[name="parent1Name"]').value;
            const parent2Name = document.querySelector('[name="parent2Name"]').value;
            const applicantNameContainer = document.getElementById('applicantNameContainer');
            const parent1NameOption = document.getElementById('parent1NameOption');
            const parent2NameLabel = document.getElementById('parent2NameLabel');
            const parent2NameOption = document.getElementById('parent2NameOption');

            if (parent1Name) {
                parent1NameOption.textContent = parent1Name;
                const parent1Radio = document.querySelector('input[name="applicantName"][value=""]');
                parent1Radio.value = parent1Name;
                parent1Radio.checked = true;
                applicantNameContainer.style.display = 'block';
            } else {
                applicantNameContainer.style.display = 'none';
            }

            if (parent2Name) {
                parent2NameLabel.style.display = 'block';
                parent2NameOption.textContent = parent2Name;
                parent2NameLabel.querySelector('input[name="applicantName"]').value = parent2Name;
            } else {
                parent2NameLabel.style.display = 'none';
                parent2NameOption.textContent = '';
                parent2NameLabel.querySelector('input[name="applicantName"]').value = '';
            }
        }

        document.querySelector('[name="parent1Name"]').addEventListener('input', updateApplicantNameOptions);
        document.querySelector('[name="parent2Name"]').addEventListener('input', updateApplicantNameOptions);
       
        document.addEventListener('DOMContentLoaded', function() {
            const accordionButtons = document.querySelectorAll('.accordion-button');
            
            accordionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;
                    
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                });
            });
            
        });

        document.addEventListener('DOMContentLoaded', function() {
            // Fetch schools and populate datalist
            fetch('https://arabicschool.azurewebsites.net/api/mainstream?code=nCeL7kzjSTmt7QGi1iROsTgStOt-jrDlJ9baxZ5wIOCCAzFu9cCanw==')
                .then(response => response.json())
                .then(schools => {
                    const datalist = document.getElementById('schools');
                    schools.forEach(school => {
                        const option = document.createElement('option');
                        option.value = school;
                        datalist.appendChild(option);
                    });
                    // Add "Other" option
                    const otherOption = document.createElement('option');
                    otherOption.value = 'Other';
                    datalist.appendChild(otherOption);
                })
                .catch(error => console.error('Error fetching schools:', error));
            
            // Show applicant name container by default
            document.getElementById('applicantNameContainer').style.display = 'block';
            
            // Set up parent name event listeners
            const parent1NameInput = document.querySelector('[name="parent1Name"]');
            parent1NameInput.addEventListener('input', updateApplicantNameOptions);
            document.querySelector('[name="parent2Name"]').addEventListener('input', updateApplicantNameOptions);
            
            // Set initial parent1 name if provided (for form reloads)
            if (parent1NameInput.value) {
                document.getElementById('parent1NameOption').textContent = parent1NameInput.value;
                const parent1Radio = document.querySelector('input[name="applicantName"][value=""]');
                parent1Radio.value = parent1NameInput.value;
                parent1Radio.checked = true;
            }
        }); 
        // Handle WWCC selection
        document.querySelectorAll('input[name="hasWWCC"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const wwccDetails = document.getElementById('wwccDetails');
                if (this.value === 'Yes') {
                    wwccDetails.style.display = 'block';
                    document.querySelectorAll('#wwccDetails input, #wwccDetails select').forEach(input => {
                        input.required = true;
                    });
                } else {
                    wwccDetails.style.display = 'none';
                    document.querySelectorAll('#wwccDetails input, #wwccDetails select').forEach(input => {
                        input.required = false;
                    });
                }
            });
        });
    </script>
</body>
</html>
