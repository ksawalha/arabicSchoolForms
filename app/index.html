<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parramatta Arabic School Enrollment Form</title>
<style>
    /* Reset and base styles */
    .pas-form * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'Arial', sans-serif;
        line-height: 1.6;
    }

    .pas-form {
        background: #fcfcfc;
        color: #333;
        padding: 0.5em;
        max-width: 100%;
        overflow: auto;
    }

    /* Typography */
    .pas-form h1 {
        color: #981c1c;
        margin-bottom: 1em;
        font-size: 1.8em;
        border-bottom: 2px solid #eee;
        padding-bottom: 0.8em;
    }

    .pas-form legend {
        font-size: 1.2em;
        padding: 0 0.8em;
        font-weight: 700;
        color: #981c1c;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    /* Form elements consistency */
    .pas-form input,
    .pas-form select,
    .pas-form textarea {
        font-size: 0.95em;
        padding: 0.8em;
        border: 1px solid #ccc;
        border-radius: 10px; /* Rounded corners */
        transition: all 0.3s ease;
        width: 100%; /* Ensure inputs and selects fill their container */
        max-width: 100%; /* Prevent overflow */
        box-sizing: border-box; /* Include padding and border in width */
    }

    .pas-form input:focus,
    .pas-form select:focus,
    .pas-form textarea:focus {
        outline: none;
        border-color: #981c1c;
        box-shadow: 0 0 0 3px rgba(152, 28, 28,0.1);
    }

    .pas-form textarea {
        resize: vertical;
        min-height: 100px;
    }

    /* Layout adjustments */
    .pas-form .form-row {
        display: flex;
        flex-direction: column; /* Stack label and field vertically */
        gap: 0.5em; /* Add spacing between label and field */
        margin-bottom: 1.2em;
    }

    /* Ensure full-width elements */
    .pas-form .form-row > .checkbox-group,
    .pas-form .form-row > .radio-group,
    .pas-form .form-row > .instruction-text,
    .pas-form .form-row > textarea {
        grid-column: 1 / -1;
        width: 100%;
    }

    /* Adjust for lone elements needing full width */
    .pas-form .form-row > :not(label):not(:first-child):last-child:not(input):not(select) {
        grid-column: 1 / -1;
    }

    .pas-form fieldset {
        margin: 1.5em 0;
        padding: 1.5em;
        border: 1px solid #ddd;
        border-radius: 6px;
        background: #f8f9fa;
    }

    /* Inline group for State, Suburb, and Post Code */
    .pas-form .inline-group {
        display: flex;
        gap: 1em;
        margin: 1em 0;
        flex-wrap: wrap; /* Allow wrapping on smaller screens */
    }

    .pas-form .inline-group .form-row {
        flex: 1 1 100%; /* Full width by default */
        min-width: 150px; /* Minimum width for each field */
    }

    /* Responsive adjustments */
    @media (max-width: 600px) {
        .pas-form .inline-group {
            flex-direction: column; /* Stack fields vertically on small screens */
            gap: 0.5em; /* Reduce gap for smaller screens */
        }

        .pas-form .inline-group .form-row {
            flex: 1 1 100%; /* Each field takes full width */
        }
    }

    /* Consistent interactive elements */
    .pas-form button {
        background: #981c1c;
        color: #fff;
        padding: 1em 2em;
        border: none;
        border-radius: 10px; /* Rounded corners */
        cursor: pointer;
        font-size: 1em;
        margin: 1.5em 0;
        transition: all 0.3s ease;
    }

    .pas-form button:hover {
        background: #003366;
        transform: translateY(-1px);
    }

    .pas-form input[type="radio"],
    .pas-form input[type="checkbox"] {
        width: auto;
        height: 1.1em;
        margin-right: 0.5em;
    }

    .pas-form .checkbox-group label,
    .pas-form .radio-group label {
        display: flex;
        align-items: center;
        margin: 0.5em 0;
    }

    /* Enhanced iframe compatibility */
    .pas-form {
        min-height: 100vh;
        box-sizing: border-box;
    }

    .pas-form .instruction-text {
        font-size: 0.9em;
        margin: 1em 0;
        padding: 1em;
        border: 1px solid #eee;
        border-radius: 4px;
        background: #f8f9fa;
        color: #555;
    }

    /* Required field styling */
    .pas-form .required {
        font-weight: 600;
    }

    .pas-form .required::after {
        content: "*";
        color: #e00;
        margin-left: 4px;
        display: inline-block;
    }

    /* Fix for content shifts */
    .pas-form select {
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 0.8em center;
        background-size: 1em;
    }

    /* Consistent spacing */
    .pas-form h3 {
        margin: 1.5em 0 1em;
        color: #444;
        font-size: 1.1em;
        padding-top: 0.5em;
        border-top: 1px solid #eee;
    }

    /* Error styling */
    .error-highlight {
        border-color: #ff0000 !important;
        box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1) !important;
    }

    .error-message {
        color: #ff0000;
        font-size: 0.9em;
        margin-top: 0.5em;
        padding: 0.5em;
        background-color: #fff0f0;
        border: 1px solid #ffcccc;
        border-radius: 4px;
        display: inline-block;
        width: 100%;
        box-sizing: border-box;
    }

    /* Loading overlay styling */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 1000;
    }

    .loading-spinner {
        width: 80px;
        height: 80px;
        animation: spin 1s linear infinite;
    }

    .loading-text {
        margin-top: 1em;
        color: #981c1c;
        font-weight: bold;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* New styles for datalist */
    .pas-form datalist {
        position: absolute;
        background: white;
        border: 1px solid #ccc;
        border-radius: 0 0 4px 4px;
        width: 100%;
    }
</style>
</head>
<body>
    <div class="pas-form">
        <h1>Student Expression of Interest</h1>
        <form id="enrollmentForm">
            <!-- Student Details Section -->
            <fieldset>
                <legend>Student Details</legend>
                <div class="instruction-text">
                    <p>* Please complete the form carefully, select the program you wish to apply for and provide your child's details as provided to their mainstream school.</p>
                </div>

                <div class="form-row">
                    <label class="required">Student First Name</label>
                    <input type="text" name="studentFirstName" required>
                </div>

                <div class="form-row">
                    <label class="required">Student Last Name</label>
                    <input type="text" name="studentLastName" required>
                </div>

                <div class="form-row">
                    <label class="required">Student Birth Date</label>
                    <input type="date" name="studentBirthDate" placeholder="DD/MM/YYYY" required>
                </div>

                <div class="form-row">
                    <label class="required">Gender</label>
                    <div class="checkbox-group">
                        <label><input type="radio" name="gender" value="Male" required> Male</label>
                        <label><input type="radio" name="gender" value="Female" required> Female</label>
                    </div>
                </div>

                <!-- Updated Mainstream School Name Field -->
                <div class="form-row">
                    <label class="required">Mainstream School Name</label>
                    <input type="text" name="mainstreamSchoolName" list="schools" required placeholder="Type to search or select 'Other'">
                    <datalist id="schools">
                        <!-- Options populated by JavaScript -->
                    </datalist>
                </div>

                <!-- New Conditional Field for "Other" School -->
                <div class="form-row" id="otherSchoolContainer" style="display: none;">
                    <label class="required">Specify School Name</label>
                    <input type="text" name="otherSchoolName">
                </div>

                <div class="form-row">
                    <label class="required">Year Level</label>
                    <select name="yearLevel" required>
                        <option value="">Select Year Level</option>
                        <option>Kindergarten</option>
                        <option>Year 1</option>
                        <option>Year 2</option>
                        <option>Year 3</option>
                        <option>Year 4</option>
                        <option>Year 5</option>
                        <option>Year 6</option>
                        <option>Year 7</option>
                        <option>Year 8</option>
                        <option>Year 9</option>
                        <option>Year 10</option>
                    </select>
                </div>
                
                <div class="instruction-text">Please provide details of any medical conditions, allergies, or specific health needs your child has. If your child requires medication or special assistance, please include this in your response.</div>

                <label>Does your child have any medical conditions or allergies we should be aware of?</label>
                <div class="form-row">
                    <textarea name="medicalInfo" rows="4"></textarea>
                </div>

                <div class="form-row">
                    <label>Student School Email</label>
                    <input type="email" name="studentEmail">
                </div>
            </fieldset>

            <!-- Family Details Section -->
            <fieldset>
                <legend>Family Details</legend>
                
                <h3>Parent/Carer 1</h3>
                <div class="form-row">
                    <label class="required">Full Name</label>
                    <input type="text" name="parent1Name" required>
                </div>

                <div class="form-row">
                    <label class="required">Relationship to Student</label>
                    <input type="text" name="parent1Relationship" placeholder="e.g. Father, Mother, Carer" required>
                </div>

                <div class="form-row">
                    <label class="required">Mobile</label>
                    <input type="tel" name="parent1Phone" required>
                </div>

                <div class="form-row">
                    <label class="required">Email</label>
                    <input type="email" name="parent1Email" required>
                </div>

                <div class="form-row">
                    <label class="required">Confirm Email Address</label>
                    <input type="email" name="parent1ConfirmEmail" required>
                </div>

                <h3>Parent/Carer 2</h3>
                <div class="form-row">
                    <label>Full Name</label>
                    <input type="text" name="parent2Name">
                </div>

                <div class="form-row">
                    <label>Relationship to Student</label>
                    <input type="text" name="parent2Relationship" placeholder="e.g. Father, Mother, Carer">
                </div>

                <div class="form-row">
                    <label>Mobile</label>
                    <input type="tel" name="parent2Phone">
                </div>

                <div class="form-row">
                    <label>Email Address</label>
                    <input type="email" name="parent2Email">
                </div>

                <h3>Address</h3>
                <div class="form-row">
                    <label class="required">Street Address</label>
                    <input type="text" name="streetAddress" required>
                </div>

                <div class="inline-group">
                    <div class="form-row" style="flex:1">
                        <label class="required">Suburb</label>
                        <input type="text" name="suburb" required>
                    </div>
                    <div class="form-row" style="flex:1">
                        <label class="required">State</label>
                        <select name="state" required>
                            <option>NSW</option>
                        </select>
                    </div>
                    <div class="form-row" style="flex:1">
                        <label class="required">Post Code</label>
                        <input type="number" name="postCode" required>
                    </div>
                </div>

                <h3>Emergency Contact</h3>
                <div class="form-row">
                    <div class="instruction-text" style="margin: 2px;">Please provide a different person's details to the one making the application.</div>
                    <label class="required">Full Name</label>
                    <input type="text" name="emergencyContactName" required>
                </div>

                <div class="form-row">
                    <label class="required">Relationship</label>
                    <input type="text" name="emergencyContactRelationship" placeholder="e.g. neighbour, aunt, uncle" required>
                </div>

                <div class="form-row">
                    <label class="required">Emergency Phone Number</label>
                    <input type="tel" name="emergencyContactPhone" required>
                    <div class="instruction-text" style="margin: 2px;">Please provide a different number than the one provided for parent one and parent two.</div>
                </div>
            </fieldset>

            <!-- Program Details Section -->
            <fieldset>
                <legend>Program Details</legend>
                <div class="instruction-text">
                    <p>The school serves students of diverse backgrounds, apps, and interests, creating a welcoming environment where they can develop their Arabic language skills. Our program focuses on building skills in reading, writing, speaking, and listening through structured lessons and interactive activities.</p>
                    <p>This is supplemented by a Quran Program that helps students memorise selected venues and improve recitation, enhancing both literacy and language development. Families who prefer their children to participate in the Arabic program only or have specific preferences are encouraged to indicate these in their application and discuss them with us during the enrolment process.</p>
                </div>

                <div class="form-row">
                    <label class="required">Arabic Proficiency Level</label>
                    <select name="proficiencyLevel" required>
                        <option value="">Select Level</option>
                        <option>Beginner â€“ My child has little to no exposure to Arabic and is just beginning to learn.</option>
                        <option>Intermediate</option>
                        <option>Advanced</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>Areas of Interest</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="interests" value="Arabic Language"> Arabic Language</label>
                        <label><input type="checkbox" name="interests" value="Quran Recitation and Tajweed"> Quran Recitation and Tajweed</label>
                        <label><input type="checkbox" name="interests" value="Quran Memorization"> Quran Memorization</label>
                        <label><input type="checkbox" name="interests" value="Others"> Others (please specify in the notes)</label>
                    </div>
                </div>

                <div class="form-row">
                    <label>Notes/Suggestions/Comments</label>
                    <textarea name="notes" rows="4"></textarea>
                </div>
            </fieldset>

            <!-- Consent & Declaration Section -->
            <fieldset>
                <legend>Consent and Declaration</legend>
                <div class="instruction-text">
                    <p>The personal information collected on this information form is for purposes directly related to your child's attendance at Parramatta Arabic School, including the processing of applications for the NSW Community Languages Schools Program, administered by the NSW Department of Education.</p>
                    <p>Any information provided to the Department of Education will be used, disclosed and stored consistent with the NSW privacy laws. Certain information is required by the Department of Education to meet its obligations in relation to data collection, reporting and the payment of grants.</p>
                </div>
                <div class="form-row">
                    <label class="required">Photo Consent</label>
                    <p class="instruction-text">The school takes photos during classroom activities and events, sharing them through our school app and social media. While we aim to accommodate exclusion requests, this may not always be practical. If you prefer your child not to be included, please discuss this with our management team.</p>
                    <div class="checkbox-group">
                        <label><input type="radio" name="photoConsent" value="Yes" required> Yes</label>
                        <label><input type="radio" name="photoConsent" value="No" required> No</label>
                    </div>
                </div>

                <div class="instruction-text">
                    <p>I consent to providing information contained on this form to the Department of Education and to confirm the accuracy of the information with other organisations that may also hold information related to the student named.</p>
                    <p>I have read the information concerning the collection of personal information. I declare that the information provided in this enrolment form is accurate and complete to the best of my knowledge.</p>
                </div>

                <div class="form-row">
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="informationAccuracy" required> I have accurately provided information related to the student in this form</label>
                        <label><input type="checkbox" name="dataSharing" required> I consent to information sharing as described above</label>
                    </div>
                </div>

                <div class="form-row">
                    <label class="required">Applicant's Full Name</label>
                    <input type="text" name="applicantName" required>
                </div>
            </fieldset>

            <div style="text-align: center">
                <button type="submit">Submit Application</button>
            </div>
        </form>

        <div id="thankYouMessage" style="display: none; text-align: center; margin-top: 2em;">
            <h1>Thank You!</h1>
            <p>Your application has been submitted successfully.</p>
            <p>We will review your application and contact you soon.</p>
        </div>

        <div id="statusMessage" style="text-align: center; margin-top: 1em;"></div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <img src="https://arabicschool.blob.core.windows.net/arabicschool/statics/loading.svg" 
             alt="Loading..." 
             class="loading-spinner">
        <div class="loading-text">Submitting your application... Please wait</div>
    </div>

   <script>
        // Clear existing error messages and highlights
        function clearExistingErrors() {
            document.querySelectorAll('.error-message').forEach(el => el.remove());
            document.querySelectorAll('.error-highlight').forEach(el => el.classList.remove('error-highlight'));
        }

        // Fetch schools and populate datalist
        document.addEventListener('DOMContentLoaded', function() {
            fetch('https://arabicschool.azurewebsites.net/api/mainstream?code=nCeL7kzjSTmt7QGi1iROsTgStOt-jrDlJ9baxZ5wIOCCAzFu9cCanw==')
                .then(response => response.json())
                .then(schools => {
                    const datalist = document.getElementById('schools');
                    schools.forEach(school => {
                        const option = document.createElement('option');
                        option.value = school;
                        datalist.appendChild(option);
                    });
                    // Add "Other" option
                    const otherOption = document.createElement('option');
                    otherOption.value = 'Other';
                    datalist.appendChild(otherOption);
                })
                .catch(error => console.error('Error fetching schools:', error));
        });

        // Handle "Other" selection
        const schoolInput = document.querySelector('[name="mainstreamSchoolName"]');
        const otherSchoolContainer = document.getElementById('otherSchoolContainer');

        schoolInput.addEventListener('input', function() {
            if (this.value === 'Other') {
                otherSchoolContainer.style.display = 'block';
                document.querySelector('[name="otherSchoolName"]').required = true;
            } else {
                otherSchoolContainer.style.display = 'none';
                document.querySelector('[name="otherSchoolName"]').required = false;
            }
        });

        // Modified validation function
        function validateForm(formData) {
            const errors = [];
            const parent1Name = formData.get('parent1Name');
            const parent1Phone = formData.get('parent1Phone');
            const parent1Email = formData.get('parent1Email');
            const parent1ConfirmEmail = formData.get('parent1ConfirmEmail');
            const parent2Name = formData.get('parent2Name');
            const parent2Phone = formData.get('parent2Phone');
            const parent2Email = formData.get('parent2Email');
            const emergencyName = formData.get('emergencyContactName');
            const emergencyPhone = formData.get('emergencyContactPhone');
            const schoolValue = formData.get('mainstreamSchoolName');
            const otherSchoolValue = formData.get('otherSchoolName');

            // Check Emergency Contact vs Parent 1
            if (emergencyName === parent1Name) {
                errors.push({ field: 'emergencyContactName', message: 'Emergency Contact name cannot be the same as Parent/Carer 1.' });
            }

            // Check Emergency Contact vs Parent 2
            if (parent2Name && emergencyName === parent2Name) {
                errors.push({ field: 'emergencyContactName', message: 'Emergency Contact name cannot be the same as Parent/Carer 2.' });
            }

            if (emergencyPhone === parent1Phone) {
                errors.push({ field: 'emergencyContactPhone', message: 'Emergency Contact phone cannot be the same as Parent/Carer 1.' });
            }

            if (parent2Phone && emergencyPhone === parent2Phone) {
                errors.push({ field: 'emergencyContactPhone', message: 'Emergency Contact phone cannot be the same as Parent/Carer 2.' });
            }

            // Check Parent 2 vs Parent 1
            if (parent2Phone && parent2Phone === parent1Phone) {
                errors.push({ field: 'parent2Phone', message: 'Parent/Carer 2 phone cannot match Parent/Carer 1.' });
            }

            if (parent2Email && parent2Email === parent1Email) {
                errors.push({ field: 'parent2Email', message: 'Parent/Carer 2 email cannot match Parent/Carer 1.' });
            }

            // Check Email Confirmation
            if (parent1Email !== parent1ConfirmEmail) {
                errors.push({ field: 'parent1ConfirmEmail', message: 'Email addresses do not match.' });
            }

            // Check "Other" School Name
            if (schoolValue === 'Other' && !otherSchoolValue) {
                errors.push({ field: 'otherSchoolName', message: 'Please specify the school name.' });
            }

            return errors;
        }

        // Modified submission handler
        document.getElementById('enrollmentForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const submitButton = event.target.querySelector('button[type="submit"]');
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            // Show loading overlay
            loadingOverlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            submitButton.disabled = true;
            clearExistingErrors();

            try {
                const formData = new FormData(event.target);
                const errors = validateForm(formData);

                if (errors.length > 0) {
                    throw new Error('Validation errors');
                }

                // Get school value
                const schoolValue = formData.get('mainstreamSchoolName');
                const otherSchoolValue = formData.get('otherSchoolName');
                const mainstream = schoolValue === 'Other' ? otherSchoolValue : schoolValue;

                const data = {
                    student: {
                        firstName: formData.get('studentFirstName'),
                        lastName: formData.get('studentLastName'),
                        birthDate: formData.get('studentBirthDate'),
                        gender: formData.get('gender'),
                        school: schoolValue,
                        yearLevel: formData.get('yearLevel'),
                        email: formData.get('studentEmail')
                    },
                    parent1: {
                        name: formData.get('parent1Name'),
                        relationship: formData.get('parent1Relationship'),
                        phone: formData.get('parent1Phone'),
                        email: formData.get('parent1Email')
                    },
                    parent2: {
                        name: formData.get('parent2Name'),
                        relationship: formData.get('parent2Relationship'),
                        phone: formData.get('parent2Phone'),
                        email: formData.get('parent2Email')
                    },
                    address: {
                        street: formData.get('streetAddress'),
                        suburb: formData.get('suburb'),
                        state: formData.get('state'),
                        postCode: formData.get('postCode')
                    },
                    emergencyContact: {
                        name: formData.get('emergencyContactName'),
                        relationship: formData.get('emergencyContactRelationship'),
                        phone: formData.get('emergencyContactPhone')
                    },
                    programDetails: {
                        proficiency: formData.get('proficiencyLevel'),
                        interests: formData.getAll('interests'),
                        notes: formData.get('notes')
                    },
                    medicalInfo: formData.get('medicalInfo'),
                    photoConsent: formData.get('photoConsent'),
                    consent: {
                        informationAccuracy: formData.get('informationAccuracy') === 'on',
                        dataSharing: formData.get('dataSharing') === 'on'
                    },
                    applicantName: formData.get('applicantName'),
                    mainstream: mainstream
                };

                console.log(JSON.stringify(data));
                const response = await fetch('https://arabicschool.azurewebsites.net/api/student?code=jBJmpUad8UZ03f6ftJkX6l55TrxIFGjvp2khZuZw1Rq6AzFuM_nJ7g==', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) throw new Error('Network response was not ok');

                // Success handling
                document.getElementById('enrollmentForm').style.display = 'none';
                document.getElementById('thankYouMessage').style.display = 'block';
                document.getElementById('statusMessage').textContent = '';
            } catch (error) {
                // Hide loading overlay on error
                loadingOverlay.style.display = 'none';
                document.body.style.overflow = '';
                submitButton.disabled = false;
                
                if (error.message === 'Validation errors') {
                    document.getElementById('statusMessage').textContent = 'Please correct the highlighted errors.';
                    errors.forEach(error => {
                        const field = document.querySelector(`[name="${error.field}"]`);
                        if (field) {
                            field.classList.add('error-highlight');
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'error-message';
                            errorDiv.textContent = error.message;
                            field.parentNode.insertBefore(errorDiv, field.nextSibling);
                        }
                    });
                } else {
                    console.error('Error:', error);
                    document.getElementById('statusMessage').textContent = 
                        'Error submitting form. Please try again or contact support.';
                }
                return;
            } finally {
                loadingOverlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        });
    </script>
</body>
</html>
